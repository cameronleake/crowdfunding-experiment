<p id="notice"><%= notice %></p>

<script type="text/javascript">  
var count =61
var redirect="/contributions/submit?expired=1&current_round_id=<%=@current_round.id%>"  
  
function countDown(){  
 if (count <=0){  
  window.location = redirect;  
 }else{  
  count--;  
  document.getElementById("timer").innerHTML = "This round will end in "+count+" seconds."  
  setTimeout("countDown()", 1000)  
 }  
}  

function validateform() {
			var total = parseInt($('#contribution_0').val()) + parseInt($('#contribution_1').val()) + parseInt($('#contribution_2').val()) + parseInt($('#contribution_3').val());
			if (total > 150) {
				$("#notice").html("<h2 class=\"alert alert-error\">Your contributions cannont total more than 150 credits.<a class=\"close\" data-dismiss=\"alert\"><h2>x</h2></a></h2>")
				return false;
			} else form.submit();
	}
</script>

<script type='text/javascript'>
$(function(){
$(document).ready(function() {
    var credits = 150
    $('#credits').text(credits)
    $('#contribution_0').keyup(function() {
        $('#credits').text(credits - $('#contribution_0').val() - $('#contribution_1').val() - $('#contribution_2').val() - $('#contribution_3').val());
    });
    $('#contribution_1').keyup(function() {
        $('#credits').text(credits - $('#contribution_0').val() - $('#contribution_1').val() - $('#contribution_2').val() - $('#contribution_3').val());
    });
    $('#contribution_2').keyup(function() {
        $('#credits').text(credits - $('#contribution_0').val() - $('#contribution_1').val() - $('#contribution_2').val() - $('#contribution_3').val());
    });
    $('#contribution_3').keyup(function() {
        $('#credits').text(credits - $('#contribution_0').val() - $('#contribution_1').val() - $('#contribution_2').val() - $('#contribution_3').val());
    });
});
}); 
</script>

<%= render @preferences if @preferences %>
<h2>Credits: <span id="credits"></span>â€‹</h2>
<p>&nbsp;</p>
<%= form_tag "/contributions/submit" , :id => 'form' do %>

<div class="row">
  <div class="span2">
    <h3>Project Name</h3>
  </div>
  
  <div class="span4">
    <h3>Funding Status</h3>
  </div>
  
  <div class="span1">
    &nbsp;
  </div>
  
  <div class="span5">
    <h3>Contributions</h3>
  </div>
</div>

<div class="row">
  <p><% @current_round.projects.each_with_index do |p,counter| %>
  
  <div class="span2">
    <%= p.name %>
  </div>
  
  <div class="span4">
    <div class="progress">
      <div class="bar" style="width: <%= (p.start_amount.to_f / p.goal_amount) * 100 %>%;"></div>
    </div>
  </div>
  
  <div class="span1">
    <%= p.start_amount %> / <%= p.goal_amount %>
  </div>
  
  <div class="span5">
    <%= text_field "amount_#{counter}", nil, :id => "contribution_#{counter}", :placeholder => '0' %><br>
	<%= hidden_field_tag "project_id_#{counter}", p.id %>
  </div>
  
<%end%>
<p>&nbsp;</p>
<div class="row">
  <div class="span2">
    <%= hidden_field_tag "current_round_id", @current_round.id %>
    &nbsp; &nbsp; &nbsp;<%= button_to_function "Submit", "validateform()", :class => 'btn-success btn-large' %>
  </div>  
</div>  
<% end %>
</div>